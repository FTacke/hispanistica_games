{# MD3 Navigation Drawer - Modal (Compact/Medium) & Standard (Expanded) #}
{% set user_name = g.user %}
{% set user_role = g.role %}
{% set is_authenticated = user_name is not none %}
{% set role_value = user_role.value if user_role else '' %}
{% set active_endpoint = request.endpoint %}

{# Define navigation items with icons #}
{% set main_nav_items = [
  {
    'label': 'Startseite',
    'href': url_for('public.landing_page'),
    'icon': 'home',
    'match': ['public.landing_page']
  },
  {
    'label': 'Gamification',
    'href': url_for('public.gamification_page'),
    'icon': 'sports_esports',
    'match': ['public.gamification_page']
  },
  {
    'label': 'Quiz',
    'href': url_for('public.quiz_page'),
    'icon': 'quiz',
    'match': ['public.quiz_page']
  }
] %}

{# Modal Navigation Drawer (Compact/Medium) - Dialog-basiert #}
<dialog id="navigation-drawer-modal" 
        class="drawer" 
        aria-label="Hauptnavigation">
  <div class="drawer__panel">
    {# Header with Brand #}
    <div class="md3-navigation-drawer__header">
      <a href="{{ url_for('public.landing_page') }}" 
         class="md3-navigation-drawer__logo-link"
         tabindex="-1"
         aria-label="Zur Startseite">
        <img src="{{ url_for('static', filename='img/hispanistica_games_logo.png') }}" 
             alt="games.hispanistica" 
             class="md3-navigation-drawer__logo">
      </a>
    </div>

    {# Main Navigation Items #}
    <nav class="md3-navigation-drawer__content" aria-label="Hauptmenü">
      {% for item in main_nav_items %}
        {% set is_active = active_endpoint in item.match %}
        
        {# Simple navigation item #}
        <a href="{{ item.href }}" 
           class="md3-navigation-drawer__item {{ 'md3-navigation-drawer__item--active' if is_active else '' }}"
           aria-current="{{ 'page' if is_active else 'false' }}">
          <span class="material-symbols-rounded md3-navigation-drawer__icon">{{ item.icon }}</span>
          <span class="md3-navigation-drawer__label">{{ item.label }}</span>
        </a>
      {% endfor %}
    </nav>

    {# Footer Navigation #}
    <nav class="md3-navigation-drawer__footer" aria-label="Weitere Links">
      {# Impressum #}
      <a href="{{ url_for('public.impressum_page') }}" 
         class="md3-navigation-drawer__item {{ 'md3-navigation-drawer__item--active' if active_endpoint == 'public.impressum_page' else '' }}">
        <span class="material-symbols-rounded md3-navigation-drawer__icon">gavel</span>
        <span class="md3-navigation-drawer__label">Impressum</span>
      </a>
      
      {# Datenschutz #}
      <a href="{{ url_for('public.privacy_page') }}" 
         class="md3-navigation-drawer__item {{ 'md3-navigation-drawer__item--active' if active_endpoint == 'public.privacy_page' else '' }}">
        <span class="material-symbols-rounded md3-navigation-drawer__icon">privacy_tip</span>
        <span class="md3-navigation-drawer__label">Datenschutz</span>
      </a>
      
      {% if is_authenticated %}
        {# Authenticated: Logout Link #}
        <a href="{{ url_for('auth.logout_any') }}"
           data-logout="fetch"
           data-logout-url="{{ url_for('auth.logout_any') }}"
           data-logout-method="POST"
           class="md3-navigation-drawer__item md3-navigation-drawer__item--logout">
          <span class="material-symbols-rounded md3-navigation-drawer__icon">logout</span>
          <span class="md3-navigation-drawer__label">Logout</span>
        </a>
      {% else %}
        {# Unauthenticated: Login #}
        <a href="{{ url_for('public.login', next=request.path) }}"
           class="md3-navigation-drawer__item">
          <span class="material-symbols-rounded md3-navigation-drawer__icon">account_circle</span>
          <span class="md3-navigation-drawer__label">Login</span>
        </a>
      {% endif %}
    </nav>
  </div>
</dialog>

{# Standard Navigation Drawer (Expanded) - für Desktop #}
<aside class="md3-navigation-drawer md3-navigation-drawer--standard" 
       id="navigation-drawer-standard"
       aria-label="Hauptnavigation">
  {# Header with Brand #}
  <div class="md3-navigation-drawer__header">
    <a href="{{ url_for('public.landing_page') }}" 
       class="md3-navigation-drawer__logo-link"
       tabindex="-1"
       aria-label="Zur Startseite">
      <img src="{{ url_for('static', filename='img/hispanistica_games_logo.png') }}" 
           alt="games.hispanistica" 
           class="md3-navigation-drawer__logo">
    </a>
  </div>

  {# Main Navigation Items #}
  <nav class="md3-navigation-drawer__content" aria-label="Hauptmenü">
    {% for item in main_nav_items %}
      {% set is_active = active_endpoint in item.match %}
      
      {# Simple navigation item #}
      <a href="{{ item.href }}" 
         class="md3-navigation-drawer__item {{ 'md3-navigation-drawer__item--active' if is_active else '' }}"
         aria-current="{{ 'page' if is_active else 'false' }}">
        <span class="material-symbols-rounded md3-navigation-drawer__icon">{{ item.icon }}</span>
        <span class="md3-navigation-drawer__label">{{ item.label }}</span>
      </a>
    {% endfor %}
  </nav>

  {# Footer Navigation #}
  <nav class="md3-navigation-drawer__footer" aria-label="Weitere Links">
    {# Impressum #}
    <a href="{{ url_for('public.impressum_page') }}" 
       class="md3-navigation-drawer__item {{ 'md3-navigation-drawer__item--active' if active_endpoint == 'public.impressum_page' else '' }}">
      <span class="material-symbols-rounded md3-navigation-drawer__icon">gavel</span>
      <span class="md3-navigation-drawer__label">Impressum</span>
    </a>
    
    {# Datenschutz #}
    <a href="{{ url_for('public.privacy_page') }}" 
       class="md3-navigation-drawer__item {{ 'md3-navigation-drawer__item--active' if active_endpoint == 'public.privacy_page' else '' }}">
      <span class="material-symbols-rounded md3-navigation-drawer__icon">privacy_tip</span>
      <span class="md3-navigation-drawer__label">Datenschutz</span>
    </a>
    
    {% if is_authenticated %}
      {# Authenticated: Logout Link #}
      <a href="{{ url_for('auth.logout_any') }}"
         data-logout="fetch"
         data-logout-url="{{ url_for('auth.logout_any') }}"
         data-logout-method="POST"
         class="md3-navigation-drawer__item md3-navigation-drawer__item--logout">
        <span class="material-symbols-rounded md3-navigation-drawer__icon">logout</span>
        <span class="md3-navigation-drawer__label">Logout</span>
      </a>
    {% else %}
      {# Unauthenticated: Login #}
      <a href="{{ url_for('public.login', next=request.path) }}"
         class="md3-navigation-drawer__item">
        <span class="material-symbols-rounded md3-navigation-drawer__icon">account_circle</span>
        <span class="md3-navigation-drawer__label">Login</span>
      </a>
    {% endif %}
  </nav>
</aside>

